<!doctype html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>WHOOP → Coubber</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:24px;line-height:1.5}
  .btn{display:inline-block;padding:12px 16px;border-radius:10px;border:1px solid #ccc;text-decoration:none}
  #fallback{display:none;margin-top:12px}
</style>
<h2>Finalitza la connexió amb WHOOP</h2>
<p>Prem el botó per continuar.</p>
<p><a class="btn" href="#" id="go">Continuar</a></p>
<div id="fallback">
  <p>El navegador ha blocat la finestra. Obre-ho manualment:</p>
  <p><a id="direct" target="_blank" rel="noopener">Obrir en una pestanya nova</a></p>
</div>
<script>
(function(){
  // POSA aquí la TEVA URL del GAS amb ?route=callback
  var GAS_BASE = "https://script.google.com/macros/s/AKfycbyisHABnBgdPJFI57ifo3VoqmQf40-gNmf877TFzCZqawRcy-RCUq6GPAn7uzugPV_T/exec?route=callback";
  var qs=location.search, hash=location.hash||"";
  var target = GAS_BASE + (qs ? (GAS_BASE.includes('?')?'&':'?') + qs.slice(1) : '') + hash;

  var go = document.getElementById('go');
  var fb = document.getElementById('fallback');
  var a  = document.getElementById('direct');
  a.href = target;

  go.onclick = function(e){
    e.preventDefault();
    var w = window.open(target, "_blank", "noopener,noreferrer");
    if(!w){ fb.style.display = 'block'; }
  };
})();
</script>
