<!doctype html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>WHOOP → Coubber</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:24px;line-height:1.5}
  .btn{display:inline-block;padding:12px 16px;border-radius:10px;border:1px solid #ccc;text-decoration:none}
  #fallback{display:none;margin-top:12px}
  code{background:#f6f8fa;padding:2px 4px;border-radius:4px}
</style>
<script>
(function(){
  // ⬇️ POSA la teva URL d’Apps Script AMB ?route=callback
  var GAS_BASE = "https://script.google.com/macros/s/AKfycbyisHABnBgdPJFI57ifo3VoqmQf40-gNmf877TFzCZqawRcy-RCUq6GPAn7uzugPV_T/exec?route=callback";

  var qs   = window.location.search;  // ?code=...&state=...
  var hash = window.location.hash || "";
  var target = GAS_BASE + (qs ? (GAS_BASE.includes('?')?'&':'?') + qs.slice(1) : '') + hash;

  // 1) intent automàtic (pot ser bloquejat per l'iframe)
  try{ setTimeout(function(){ window.top.location.href = target; }, 0); }catch(e){}

  // 2) funció per al botó: si TOP falla, obrim pestanya nova
  window.__go = function(){
    try{ window.top.location.href = target; }
    catch(e){
      var w = window.open(target, "_blank", "noopener,noreferrer");
      if(!w){
        // 3) el navegador ha bloquejat el popup: mostra enllaç manual
        var fb=document.getElementById('fallback'), a=document.getElementById('direct');
        a.href = target; fb.style.display='block';
      }
    }
  };

  // últim recurs: meta refresh (no sempre funciona)
  document.write('<meta http-equiv="refresh" content="4;url='+ target.replace(/"/g,'%22') +'">');
})();
</script>

<h2>Finalitza la connexió amb WHOOP</h2>
<p>Si no es redirigeix automàticament, prem el botó:</p>
<p><a class="btn" href="javascript:void 0" onclick="__go()">Continuar</a></p>

<div id="fallback">
  <p>El navegador ha blocat la finestra emergent. Obre aquest enllaç:</p>
  <p><a id="direct" target="_blank" rel="noopener">Obrir en una pestanya nova</a></p>
  <p style="font-size:12px;color:#666">També pots permetre pop-ups per <code>guillemcabot.github.io</code> i tornar-ho a provar.</p>
</div>
